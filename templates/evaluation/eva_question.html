{% extends "layouts/base-fullscreen.html" %}

{% block title %} {{text.signin}} {% endblock %}
{% block stylesheets %}{% endblock stylesheets %}
{% load custom_tags %}
{% block content %}
{% block header %}
{% include 'includes/g_header.html' %}
{% endblock %}
<main id="indi">
    {% include "includes/hero_section.html" %}
    <div class="section pt-0">
        <div class="container-fluid pt-6 mt-n10 mt-lg-n12 z-2">
            <div class="row justify-content-center">
                <div class="col-12">
                    <button class="btn btn-warning btn-block mb-2" onclick="history.back()">Go Back</button>
                    <div class="card text-center mb-4">
                        <div class="card-header">
                            <h3 class="text-success">To be answered questions</h3>
                            <hr>
                            <h5 class="text-danger" style="font-size: 14px;">
                                The title of the question below can be
                                found by hovering your mouse over the round. The system will automatically send you to
                                the next question. If you wish, you can tweak it even more. The green circles indicate
                                that it has been answered, the grey circles indicate that it has been skipped or that it
                                is you do not know, and the outline circles suggest that it has not yet been replied.
                                You won't be able to answer the child questions if you don't answered the parent
                                questions.
                            </h5>
                        </div>

                        <div class="row p-3 justify-content-center">
                            {% for parent, child in question_dataset.items %}
                            <div class="col-sm-4 col-md-3 col-lg-2 col-xl-1 mb-3 d-flex">
                                <div style="min-height: 5rem;" class="card flex-fill">
                                    <a style="padding: 0.05rem; font-size: 0.25rem;"
                                        class="btn {% if slug == parent.slug %} btn-primary {% else %} {% if parent.stat == 'checked' %} btn-success {% elif parent.stat == 'skipped' %} btn-gray-100  {% else %} btn-outline-success {% endif %} {% endif %} mb-1  col-12 mx-auto "
                                        data-bs-toggle="tooltip" data-bs-html="true" title="{{parent.name}}"
                                        href="{% url 'evaluation:eva_question' request.session.evaluator parent.slug %}">
                                        {% if parent.sort_order %}--{% else %}--{% endif %}
                                    </a>

                                    <div class="col-12 p-2">
                                        {% for item in child %}
                                        <a style="padding: 0.08rem; font-size: 0.25rem;"
                                            class="btn {% if slug == item.slug %} btn-primary {% else %} {% if item.stat == 'checked' %} btn-success {% elif item.stat == 'skipped' %} btn-gray-100  {% else %} btn-outline-success {% endif %} {% endif %} mb-1 rounded-circle "
                                            data-bs-toggle="tooltip" data-bs-html="true" title="{{item.name}}"
                                            style="font-size: 4px;"
                                            href="{% url 'evaluation:eva_question' request.session.evaluator item.slug %}">
                                            --
                                        </a>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="card-header">
                            {{ timing_text }}
                        </div>
                    </div>
                    <div id="ques" class="card text-center">
                        <div class="card-footer">
                            <h3>Question: {{question.name}}</h3>
                        </div>
                        <div class="card-footer">
                            {% if question.description %}
                            <p>{{question.description}}</p>
                            {% else %}
                            <p>Description of the question are coming soon in this place!</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row mb-5">
                        {% if messages and total_question <= qualified_rang %} 
                        <div class="alert alert-secondary mt-5" role="alert">
                            {% if messages and total_question <= qualified_rang %} 
                            {% for message in messages %} 
                                <span class="alert-inner--text">{{ message }}</span>
                            {% endfor %} 
                            {% endif %}                           
                        </div>
                        {% endif %}
                    </div>
                    <div class="row mt-5 mb-5">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5>Options:</h5>

                                    
                                    
                                    <form id="op" method="POST" action="{% url 'evaluation:option_add2' %}#ques">
                                        {% csrf_token %}
                                        {% for optn in optns %}
                                        <fieldset>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="option_id"  id="{{optn.id}}" value="{{optn.id}}" {% if optn.id == selected_option.id %} checked {% endif %} required>
                                                <label class="form-check-label" for="{{optn.id}}">{{optn.name}}</label>
                                            </div>
                                            
                                        </fieldset>
                                        {% endfor %}
                                        
                                        <h5 class="mt-4">
                                            Please submit any further information you have about your fuel
                                            oil
                                            in answer to the above request. The platform will take your inputs in
                                            consideration when evaluating this fuel:
                                        </h5>
                                        <div class="mt-3">
                                            <textarea class="form-control" id="comment"
                                                name="comment">{{submitted_comment|safe}}</textarea>
                                            <input type="hidden" name="slug" value="{{slug}}">
                                        </div>
                                        <div class="mt-3 d-flex">
                                            <!--
                                            <button 
                                                type="submit"
                                                name="get_feedback"
                                                hx-post="."
                                                id="get_feedback"
                                                class="btn btn-success btn-block m-2">
                                                Submit
                                            </button>
                                            -->
                                            <input class="btn btn-success btn-block m-2" type="submit" hx-post="{% url 'evaluation:option_add2' %}{% if messages %}#msg{% else %}#ques{% endif %}"
                                            hx-push-url="{{request.path}}#ques" value="Submit" hx-indicator="#feedbackspinner"
                                            hx-target="body" hx-swap="innerHTML" hx-vals='{"get_feedback": "get_feedback"}'
                                            hx-trigger="click">
                                            
                                            <div id="feedbackspinner" class="feedback-indicator">                                                
                                                <button class="btn btn-primary btn-block m-2" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                                                Working...
                                                </button>
                                            </div>
                                            
                                        </div>
                                        <div class="mt-3">
                                            <h5>GFVP Feedback:</h5>
<textarea class="form-control" id="feedback" rows="6" disabled>
{{selected_option.statement|safe}}
</textarea>
                                        </div>

                                        
                                        <div class="mt-3 d-flex">
                                            <!--
                                            <button 
                                                type="submit" 
                                                name="submit_and_auto" 
                                                value="Submit"
                                                class="btn btn-success btn-block m-2">
                                                Confirm
                                            </button>
                                            -->

                                            


                                            <input class="btn btn-success btn-block m-2" type="submit" hx-post="{% url 'evaluation:option_add2' %}#ques"
                                            hx-push-url="{{request.session.push_url}}" value="Confirm" hx-indicator="#confirmspinner"
                                            hx-target="body" hx-swap="outerHTML" hx-vals='{"submit_and_auto": "submit_and_auto"}'
                                            hx-trigger="click">
                                            
                                            <div id="confirmspinner" class="confirm-indicator">                                                
                                                <button class="btn btn-primary btn-block m-2" type="button" disabled>
                                                <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                                                Working...
                                                </button>
                                            </div>
                                            


                                        </div>
                                    </form>
                                    
                                </div>
                            </div>      

                            <div class="card mt-4">
                                <div class="card-header">
                                    The validation quotes issued by our validation partners are listed below. To learn
                                    more
                                    about a quote, simply click on it.
                                </div>
                                <div class="card-body">
                                    <div class="row mt-3 g-3">
                                        {% if question.get_quotations or question.get_related_quotations %}
                                        {% for quotation in question.get_quotations %}
                                        <div class="col-md-6 col-xl-4 d-flex">
                                            <a href="{{quotation.get_absolute_url}}" 
                                                target="_blank"
                                                class="p-3 flex-fill card">
                                                <h4>Provider: 
                                                    {{quotation.get_business_name}}
                                                </h4>
                                                <h5>Price: {{quotation.price}} {{quotation.price_unit}} </h5>
                                            </a>
                                        </div>
                                        {% endfor %}
                                        {% for quotation in question.get_related_quotations %}
                                        <div class="col-md-6 col-xl-4 d-flex">
                                            <a href="{{quotation.get_absolute_url}}" 
                                                target="_blank"
                                                class="p-3 flex-fill card">
                                                <h4>Provider: {{quotation.get_business_name}}
                                                </h4>
                                                <h5>Price: {{quotation.price}} {{quotation.price_unit}}</h5>
                                            </a>
                                        </div>
                                        {% endfor %}
                                        {% else %}
                                        <p>No Quotation Found!</p> 
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="alert alert-success" role="alert">
                                Greenfuel Summary
                            </div>
                            <div class="card">
                                <div class="card-body">
{% for eva_lebel in eva_lebels %}
{{eva_lebel.label.label}}
<textarea name="tarea" class="form-control" rows="6" id="floatingTextarea" disabled>
{% if total_question >= qualified_rang %}
{% for el in eva_lebel.evalebelstatement_set.all %}{{el.statement.strip|safe}}
{{el.next_step.strip|safe}}
{% endfor %}
{% else %}
<p>Need to submit minimum {{ qualified_rang }} qualified ans to view your results! Current is {{ total_question }} !</p>
{% endif %}
</textarea>
{% endfor %}
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            {% if chart_data %}
                            <div class="card mt-4 p-4">
                                <h4>{{question.chart_title}}</h4>
                                <div class="table-responsive">
                                    <table class="table align-middle">
                                        <thead>
                                            <tr>
                                                <th scope="col">Oil Name</th>
                                                <th scope="col">Unit</th>
                                                <th scope="col">Value</th>
                                                <th scope="col">Link</th>
                                                <th scope="col">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for cd in chart_data %}
                                            <tr>
                                                <th scope="row">{{cd.oil_name }}</th>
                                                <td>{{cd.unit }}</td>
                                                <td>{{cd.value }}</td>
                                                <td>{{cd.link }}</td>
                                                <td {% if cd.option.yes_status %} class="table-success" {% elif not cd.option.yes_status %} class="table-danger" {% else %} class="table-dark" {% endif %}></td>

                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            {% endif %}
                            <!--
                            <div class="card text-center mb-4 mt-4">
                            <div class="row justify-content-center align-items-center">
                                <h3 id="osc" >Oil's Standard Chart:</h3> 
                                {% for d in oil_graph_data %} 
                                {% for k, label_and_datalist in d.items %}                                  
                                <div class="col-12 col-lg-4 col-md-6 d-flex mb-4">
                                    <div class="flex-fill border rounded p-2">                                                                      
                                        <div class="ct-chart-com ct-chart-oil{{k}} ct-golden-section ct-series-a"></div> 
                                        <small class="border-top border-3 border-danger">{{k}}</small>                                            
                                    </div>                                    
                                </div>
                                {% endfor %}
                                {% endfor %}
                                </div>
                            </div>
                        -->



                            <div class="card text-center mb-4 mt-4">
                                <h4>Some relevant videos are listed below:</h4>
                                <div class="row p-3 justify-content-center">
                                    {% for vu in vedio_urls %}
                                    <div class="col-sm-12 col-md-4 mb-3">
                                        <iframe 
                                            width=100% 
                                            height="315" 
                                            src="{{vu}}" 
                                            title="YouTube video player"
                                            frameborder="0"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowfullscreen>
                                        </iframe>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% include "includes/g_footer.html" %}
{% endblock content %}


<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
    <script>
        var oil_graph_data;    
        
        oil_graph_data = {{ oil_graph_data | safe }};   
        for (var ogd in oil_graph_data){
            var grap_oils;
            grap_oils = oil_graph_data[ogd];            
            for (var grap_oil in grap_oils){
                var go, label, series;
                go = grap_oils[grap_oil];
                label = go[0];
                series = go[1];
                if(document.querySelector('.ct-chart-oil' + grap_oil)) {
                    var compchart = new Chartist.Bar('.ct-chart-oil' + grap_oil, {
                        labels: label,
                        series: series
                      }, {           
                        
                        seriesBarDistance: 10,
                        plugins: [
                          Chartist.plugins.tooltip()
                        ],
                        
                        axisX: {                        
                            offset: 100,                        
                          },
                        axisY: {
                            offset: 100,
                            labelInterpolationFnc: function(value) {
                                return value + ' %'
                                },
                                scaleMinSpace: 15    
                        }                    
                        });                  
                      compchart.on('draw', function(data) {
                        if(data.type === 'bar') {
                            data.element.attr({
                              style: 'stroke-width: 10px;stroke-linecap: square; width:auto;height:auto;'
                            });
                        }                     
                    });
                }
            } 
        }     
    </script>

    {% endblock javascripts %}